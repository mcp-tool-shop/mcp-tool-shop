---
import Layout from '../../layouts/Base.astro';

const LAB_SECTIONS = [
  {
    id: "quality",
    title: "Quality & Compliance",
    items: [
      { href: "/lab/audit/", icon: "üßæ", title: "Audit Scoreboard", desc: "Tool metadata accuracy and validation status", badge: "Live" },
      { href: "/lab/health/", icon: "‚ù§Ô∏è", title: "README Health", desc: "Content quality analysis for tool documentation", badge: "Live" },
      { href: "/lab/clearance/", icon: "üõ°Ô∏è", title: "Safety Clearance", desc: "Security and safety compliance checks", badge: "Internal" },
    ],
  },
  {
    id: "pipeline",
    title: "Pipeline Monitoring",
    items: [
      { href: "/lab/baseline/", icon: "üìà", title: "Baseline Performance", desc: "Benchmarks and regression testing", badge: "Internal" },
      { href: "/lab/drift/", icon: "üß≠", title: "Drift Detection", desc: "Configuration and infrastructure drift analysis", badge: "Internal" },
      { href: "/lab/ops/", icon: "‚öôÔ∏è", title: "Ops History", desc: "Pipeline execution logs and success rates", badge: "Internal" },
      { href: "/lab/telemetry-export/", icon: "üß™", title: "Telemetry", desc: "Raw data retention and export", badge: "Internal" },
    ],
  },
  {
    id: "governance",
    title: "Governance & Promotion",
    items: [
      { href: "/lab/control/", icon: "üéõÔ∏è", title: "Control Surface", desc: "Operator actions for governance and promotion", badge: "Internal" },
      { href: "/lab/promo/", icon: "üì£", title: "Promotion Track", desc: "Active promotion campaigns and status", badge: "Internal" },
      { href: "/lab/worthy/", icon: "‚≠ê", title: "Worthy Candidates", desc: "Tools flagged for potential promotion", badge: "Internal" },
      { href: "/lab/queue/", icon: "üßµ", title: "Queue", desc: "Pending review and processing queue", badge: "Internal" },
    ],
  },
  {
    id: "intel",
    title: "Market Intelligence",
    items: [
      { href: "/lab/marketir/", icon: "üìä", title: "Market IR", desc: "Investor relations and market analysis", badge: "Internal" },
      { href: "/lab/metrics/", icon: "üå±", title: "Growth Metrics", desc: "User adoption and catalog growth stats", badge: "Internal" },
      { href: "/lab/signals/", icon: "üì°", title: "Signals", desc: "Early warning indicators and trends", badge: "Internal" },
      { href: "/lab/targets/", icon: "üéØ", title: "Targets", desc: "Strategic acquisition and integration targets", badge: "Internal" },
    ],
  },
];
---

<Layout title="The Lab" description="Experimental tools, dashboards, and internal utilities for managing the MCP Tool Shop.">
  <style>
    .subhead { max-width: 70ch; opacity: 0.85; margin-top: 0.75rem; color: #a1a1aa; font-size: 1.125rem; line-height: 1.75rem; }
    .section { margin-top: 3rem; }
    .grid { display: grid; gap: 1rem; grid-template-columns: repeat(1, minmax(0, 1fr)); }
    @media (min-width: 640px) { .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (min-width: 1024px) { .grid { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
  
    .card {
      display: flex; flex-direction: column; gap: 0.5rem;
      padding: 1.25rem;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 0.75rem;
      text-decoration: none;
      background: rgba(255,255,255,0.03);
      transition: all 0.2s ease;
      min-height: 140px;
    }
    .card:hover { 
      transform: translateY(-2px); 
      background: rgba(255,255,255,0.06); 
      border-color: rgba(255,255,255,0.2); 
    }
    .row { display: flex; align-items: flex-start; justify-content: space-between; gap: 0.75rem; margin-bottom: 0.25rem; }
    .title-group { display: flex; align-items: center; gap: 0.75rem; }
    .icon { font-size: 1.5rem; }
    .title { font-weight: 600; color: white; font-size: 1.125rem; }
    .desc { opacity: 0.7; line-height: 1.5; color: #d4d4d8; font-size: 0.95rem; }
    .badge {
      font-size: 0.7rem; padding: 0.15rem 0.5rem; border-radius: 9999px;
      border: 1px solid rgba(255,255,255,0.15); opacity: 0.8;
      background: rgba(255,255,255,0.05);
      white-space: nowrap; color: #e4e4e7; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 500;
    }
    
    /* Admin nav helper */
    #admin-nav-hint { font-size: 0.875rem; margin-top: 4rem; opacity: 0.4; color: #a1a1aa; text-align: center; }
  </style>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <h1 class="text-4xl font-extrabold tracking-tight text-white sm:text-5xl">The Lab</h1>
    <p class="subhead">Experimental tools & dashboards for auditing, monitoring, and growing the ecosystem.</p>
  
    {LAB_SECTIONS.map((sec) => (
      <section class="section" aria-labelledby={sec.id}>
        <h2 id={sec.id} class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
            {sec.title}
        </h2>
        <div class="grid">
          {sec.items.map((it) => (
            <a class="card group" href={it.href}>
              <div class="row">
                <div class="title-group">
                    <span class="icon">{it.icon}</span> 
                    <span class="title">{it.title}</span>
                </div>
                {it.badge ? <span class="badge">{it.badge}</span> : null}
              </div>
              <div class="desc">{it.desc}</div>
              <div class="mt-auto flex justify-end opacity-0 group-hover:opacity-100 transition-opacity duration-200 text-indigo-400">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
              </div>
            </a>
          ))}
        </div>
      </section>
    ))}
    
    <div id="admin-nav-hint">
      Tip: append <code>?admin=1</code> to enable the admin nav dropdown.
    </div>
  </div>
  
  <script is:inline>
    (function () {
      const KEY = "mcptoolshop_admin_nav";
      
      if (typeof window !== "undefined") {
        const url = new URL(window.location.href);

        // Enable via ?admin=1
        if (url.searchParams.get("admin") === "1") {
          localStorage.setItem(KEY, "1");
          url.searchParams.delete("admin");
          window.history.replaceState({}, "", url.toString());
          // Optional: visually acknowledge
        }

        // Enable via Ctrl+Shift+L
        window.addEventListener("keydown", (e) => {
          if (e.ctrlKey && e.shiftKey && (e.key === "L" || e.key === "l")) {
            localStorage.setItem(KEY, "1");
            alert("Lab mode enabled. Reloading...");
            window.location.reload();
          }
        });
      }
    })();
  </script>
</Layout>
